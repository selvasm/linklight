---
- hosts: localhost
  become: false
  tasks:

    - name: Create new  Routers
      azure_rm_virtualmachine:
        resource_group: AnsibleTower-Killian-Zoubayer
        name: "{{ item }}"
        state: absent
        remove_on_absent: 
          - virtual_storage
          - public_ips
      with_items:
        - Router-2
        - Router-3
      async: 45
      poll: 0

    - name: To Wait till the routers are down
      wait_for:
        host: "{{ item }}"
        state: absent
        delay: 40
      with_items:
        - Router-2
        - Router-3

    
    - debug:
        msg: "All Resources are deleted"
      
      